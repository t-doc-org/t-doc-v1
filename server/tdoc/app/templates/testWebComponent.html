<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="content-language" content="en">

  <!-- Pour éviter l'erreur avec favicon.ico qui n'existe pas -->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script>window.MathJax = { tex: { tags: "ams", }, }; </script>
  <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>

  <script type="text/javascript">

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

class LatexComponent extends HTMLElement {
  constructor() {
    super();
    this.shadow =  this.attachShadow({mode: 'open'});
    this.content = document.createElement('div');
    this.shadow.appendChild(this.content);
    // let div1 = document.createElement('div');
    // let content1 = document.createTextNode("Hello World!");
    // this.shadow.appendChild(div1);
    // div1.appendChild(content1);

    this.observer = new MutationObserver(async (mutation) => {
      // console.log(mutation);
      this.render();
    });
  }

  async connectedCallback() {
    await this.render();
    this.observer.observe(this, {childList: true, characterData: true, subtree: true});
  }

  disconnectedCallback() {
    this.observer.disconnect();
  }

  async render() {
    console.log("render");
    const text = this.textContent;
    if (!text) return;

    console.log("performing rendering");
    const response = await fetch('/render-latex', {
      method: 'POST',
      headers: {'X-CSRFToken': getCookie('csrftoken')},
      mode: 'same-origin',
      cache: 'no-cache',
      body: text,
    })
    // this.shadow.innerHTML = await response.text();

    MathJax.typesetClear([this.content]);
    this.content.innerHTML = await response.text();
    console.log("response received");
    await MathJax.typesetPromise([this.content]);
  }
}

customElements.define('tdoc-latex', LatexComponent);

  </script>


  <title>Test du LaTeX WebComponent</title>
</head>

<body>
  <h1>Envoyer du latex au serveur</h1>

  <p id="p1"> Ceci est un document qui contient un paragraphe et du latex.</p>

  <tdoc-latex>
\documentclass[a4paper,11pt]{article}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}

\usepackage{amssymb,amsmath,amsfonts, amsfonts}
\usepackage{enumitem}
\usepackage{array}
\usepackage{multicol}

\begin{document}
\section{Équations du deuxième degré}
\subsection{théorie}
Toute équation quadratique donnée sous la forme $ax^2+bx+c=0 a \ne 0$ (a  \ne 0 en version texte est ok).
peut être résolue à l'aide de la formule suivante
$$x_{1,2}=\dfrac{-b \pm \sqrt{b^2-4ac}}{2a}$$
${x_1}$ et ${x_2}$ sont appelées les \textbf{racines} du trinôme.\\
L'expression sous la racine $$\Delta= \mathbf{b^2-4ac}$$ est appelée le \textbf{discriminant} et détermine le nombre de solutions d'une équation quadratique:\\
<!-- $\begin{array}{|l | l |}
\hline
\Delta>0 & \text{L'équation a \textbf{deux solutions} réelles} \\
& \text{Le polynôme factorisé est de la forme:}  a(x - x_{1})(x - x_{2}) \\
\hline
\Delta=0 & \text{L'équation a \textbf{une solution} réelle (solution double)}\\
& \text{Le polynôme factorisé est de la forme:}  a(x - x_{1})^2\\
\hline
\Delta<0 & \text{L'équation \textbf{n'a pas de solution} réelle}\\
& \text{Le polynôme ne peut pas être factorisé.}\\
\hline
\end{array}$\par -->
Listes non numérotées:\par
\begin{itemize}
\item $2x^2+6x-8=0$ possède deux solutions.
\item L'équation $4x^2+2=4x$ n'a pas de solution.
\item L'équation $\frac{3}{2}x^2+6x+6=0$ possède une solution.
\end{itemize}
Listes numérotées la numérotation ne peut pas être changée:\par
\begin{enumerate}
\item $2x^2+6x-8=0$ possède deux solutions.
\begin{enumerate}
\item item 1
\item item 2
\end{enumerate}
\item L'équation $4x^2+2=4x$ n'a pas de solution.
\item L'équation $\dfrac{3}{2}x^2+6x+6=0$ possède une solution.
\end{enumerate}
Multicolonnes:\par
\begin{multicols}{3}
Voici ma première colonne qui ne raconte pas grand chose, mais ce n'est pas grave, car ce n'est pas le but.\par
Voici ma deuxième colonne qui ne raconte pas grand chose, mais ce n'est pas grave, car ce n'est pas le but.\par
Voici ma troisième colonne qui ne raconte pas grand chose, mais ce n'est pas grave, car ce n'est pas le but.\par
\end{multicols}

\subsection{Exercices}

\begin{enumerate}
\item Résoudre les équations suivantes et écrire le polynôme sous forme factorisée.
\begin{multicols}{2}
\begin{enumerate}
\item $2x^2=50$
\item $4x^2-9x=0$
\item$x^2+6x=-9$
\item $\dfrac{5}{3}x^2+3x+1=0$
\end{enumerate}
\end{multicols}


\item En diminuant deux côtés parallèles d'un carré de $2\,cm$ et en prolongeant les deux autres côtés de $5\,cm$, on obtient un rectangle dont l'aire vaut $11\,cm^2$ de plus que celle du carré original.\\ Quelle est la longueur du côté du carré?

\item Quel nombre positif est de 48.75 inférieur à son carré?

\item Si on augmente de $30\,cm$ le rayon d'un cercle, son aire est triplée. Que vaut le rayon initial?

\end{enumerate}

Solution:\par
$S=\{5;-5\}$ et $P(x) = 2(x-5)(x+5)$\par
Résolution d'équations: \par
$\begin{array}{rclrl}
x^2 + 4 & \geq & 5x &|& -5x \\
x^2 -5x + 4 & \geq & 0 &|& \text{ (factorisation)} \\
(x-4)(x-1) & \geq & 0 &|& \\
\end{array}$

$\begin{array}{rclrl}
x^2 + 4 & \geq & 5x &|& -5x \\
x^2 -5x + 4 & \geq & 0 &|& \text{ (factorisation)} \\
(x-4)(x-1) & \geq & 0 &|& \\
\end{array}$\par
Maintenant il faut étudier le signe de $(x-4)(x-1)$\par
Les zéros de l'équations $(x-4)(x-1)=0$ sont 4 et 1.\par
<!-- $\begin{array}{|c|c c c c c c c|}
\hline
\text{facteurs} & -\infty &  & 1 & & 4& & +\infty\\
\hline
x-4 & & - & - & - & 0& + & \\
\hline
x-1 & & - & 0 & + & +& + & \\
\hline
(x-4)(x-1) & & + & 0 & - & 0& + & \\
\hline
\end{array}$\par -->

\end{document}
  </tdoc-latex>

</body>

</html>
